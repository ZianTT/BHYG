
<html>
<head>
    <script src="https://static.geetest.com/static/js/gt.0.4.9.js"></script>
</head>
<body>
   <p>必要时，这里会出现验证码</p> 
    <script>
        function showCaptcha(gt, challenge) {
            initGeetest({
                // 以下配置参数来自服务端 SDK
                product: 'bind',
                gt: gt,
                challenge: challenge,
                offline: false,
                new_captcha: true,
                hideClose:  true,
            }, function (captchaObj) {
                    // 这里可以调用验证实例 captchaObj 的实例方法
                    captchaObj.onReady(function(){
                    //验证码ready之后才能调用verify方法显示验证码
                        captchaObj.verify();
                    });
                    captchaObj.onSuccess(function () {
                        var result = captchaObj.getValidate();
                        data = {
                            success: true,
                            challenge: result.geetest_challenge,
                            validate: result.geetest_validate,
                            seccode: result.geetest_seccode,
                        };
                        fetch("http://127.0.0.1:{{port}}/api?data="+JSON.stringify(data))
                        captchaObj.destroy();
                    });
                    captchaObj.onError(function () {
                        data = {
                            success: false
                        };
                        fetch("http://127.0.0.1:{{port}}/api?data="+JSON.stringify(data))
                        captchaObj.destroy();
                    });
                    captchaObj.onClose(function () {
                        data = {
                            success: false
                        };
                        fetch("http://127.0.0.1:{{port}}/api?data="+JSON.stringify(data))
                        captchaObj.destroy();
                    });
                });
            };
        // 每隔一秒向服务端发送get请求并查看返回值
        setInterval(function() {
            fetch("http://127.0.0.1:{{port}}/api")
            .then(response => response.json())
            .then(data => {
                if (data.type === 'geetest') {
                    showCaptcha(data.data.gt, data.data.challenge)
                }
            });
        }, 1000);

    </script>
</body>
</html>
